<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracoin - 실시간 암호화폐 분석 및 인사이트</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111827">
    <meta name="google-adsense-account" content="ca-pub-5892610452724367">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5892610452724367"
     crossorigin="anonymous"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #030712; }
        .page-section { display: none; }
        .page-section.active { display: block; }
        .nav-link.active { color: #3b82f6; border-bottom: 2px solid #3b82f6; }
        .prose { color: #d1d5db; }
        .prose h1, .prose h2, .prose h3 { color: #f9fafb; }
        .prose a { color: #60a5fa; }
        .prose blockquote { border-left-color: #374151; }
        .prose code { color: #f9fafb; background-color: #1f2937; padding: 0.2em 0.4em; border-radius: 0.3em;}
        .prose pre { background-color: #1f2937; padding: 1em; border-radius: 0.5em; }
        /* 기존 스타일 유지 */
        .eval-buy { color: #22c55e; }
        .eval-caution { color: #ef4444; }
        .eval-neutral { color: #64748b; }
        .control-btn.active { background-color: #3b82f6; color: white; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        .star-icon { cursor: pointer; transition: color 0.2s, transform 0.2s; }
        .star-icon:hover { transform: scale(1.2); }
        .star-icon.favorited { color: #facc15; }
        #modal-overlay { background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); }
        #coin-list-sidebar::-webkit-scrollbar { width: 4px; }
        #coin-list-sidebar::-webkit-scrollbar-track { background: #1f2937; }
        #coin-list-sidebar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 2px; }
        #limit-message { transition: opacity 0.5s; }
        .skeleton-card { background-color: #1f2937; border-radius: 1rem; padding: 1.25rem; }
        .skeleton { background-color: #374151; border-radius: 0.5rem; }
        #watchlist-toggle:checked ~ .dot { transform: translateX(100%); background-color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- 헤더 및 네비게이션 -->
    <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-40 border-b border-gray-700">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="#" class="nav-link text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500" data-page="home">Oracoin</a>
                </div>
                <nav class="hidden md:flex md:space-x-8">
                    <a href="#" class="nav-link text-gray-300 hover:text-white transition-colors duration-200 py-2" data-page="home">홈</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-white transition-colors duration-200 py-2" data-page="blog">블로그 & 분석</a>
                    <a href="#" class="nav-link text-gray-300 hover:text-white transition-colors duration-200 py-2" data-page="about">소개</a>
                </nav>
                <div class="flex items-center">
                    <div class="flex space-x-2 mr-4">
                        <button id="lang-ko" class="lang-btn control-btn px-3 py-1 text-sm rounded-md">KO</button>
                        <button id="lang-en" class="lang-btn control-btn px-3 py-1 text-sm rounded-md">EN</button>
                    </div>
                    <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- 모바일 메뉴 -->
        <div id="mobile-menu" class="md:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700" data-page="home">홈</a>
                <a href="#" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700" data-page="blog">블로그 & 분석</a>
                <a href="#" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:text-white hover:bg-gray-700" data-page="about">소개</a>
            </div>
        </div>
    </header>

    <!-- 메인 컨텐츠 영역 -->
    <div id="page-container">

        <!-- 홈 (분석 도구) 페이지 -->
        <section id="home-page" class="page-section active">
            <div class="flex h-screen-minus-header" style="height: calc(100vh - 4rem);">
                <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-20 hidden lg:hidden"></div>
                <aside id="sidebar" class="fixed inset-y-0 left-0 z-30 w-64 bg-gray-800/80 backdrop-blur-sm p-4 flex flex-col h-full border-r border-gray-700 transition-transform duration-300 ease-in-out transform -translate-x-full lg:relative lg:translate-x-0 lg:h-auto">
                    <h2 class="text-xl font-bold mb-2 text-center" data-lang-key="sidebar_title">코인 목록 (상위 100)</h2>
                    <p id="limit-message" class="text-center text-red-400 text-xs mb-2 h-4 opacity-0" data-lang-key="limit_message">최대 6개까지 추가 가능합니다.</p>
                    <div id="coin-list-sidebar" class="flex-grow overflow-y-auto"></div>
                </aside>
                <main class="flex-grow p-4 md:p-6 overflow-y-auto h-full relative">
                    <button id="sidebar-toggle" class="fixed top-20 left-4 z-10 p-2 bg-gray-700/50 backdrop-blur-sm rounded-md text-white hover:bg-gray-600 transition-colors lg:hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                    </button>
                    <div class="container mx-auto max-w-7xl">
                        <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700 p-4 rounded-xl mb-6 space-y-4 md:space-y-0 md:flex md:items-center md:justify-between">
                            <div class="relative flex-grow md:max-w-xs">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3"><svg class="w-5 h-5 text-gray-400" viewBox="0 0 24 24" fill="none"><path d="M21 21L15.803 15.803M15.803 15.803C17.2236 14.3824 18 12.4731 18 10.5C18 6.35786 14.6421 3 10.5 3C6.35786 3 3 6.35786 3 10.5C3 14.6421 6.35786 18 10.5 18C12.4731 18 14.3824 17.2236 15.803 15.803Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></span>
                                <input id="search-input" type="text" data-lang-key="search_placeholder" placeholder="추가된 코인 검색..." class="w-full bg-gray-700 text-white placeholder-gray-400 border border-gray-600 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex items-center justify-center space-x-2">
                                <button id="sort-name" class="sort-btn control-btn px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600" data-lang-key="sort_name">이름순</button>
                                <button id="sort-price" class="sort-btn control-btn px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600" data-lang-key="sort_price">가격순</button>
                                <button id="sort-change" class="sort-btn control-btn px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600" data-lang-key="sort_change">변동률순</button>
                            </div>
                            <div class="flex items-center justify-center">
                                <label for="watchlist-toggle" class="flex items-center cursor-pointer"><span class="mr-3 text-sm font-medium text-gray-300" data-lang-key="watchlist">⭐ 관심 목록</span><div class="relative"><input type="checkbox" id="watchlist-toggle" class="sr-only"><div class="block bg-gray-600 w-14 h-8 rounded-full"></div><div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div></div></label>
                            </div>
                        </div>
                        <div id="loading-indicator" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                        <div id="crypto-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                        <div id="no-results" class="hidden text-center text-gray-400 py-10 col-span-full"></div>
                    </div>
                </main>
            </div>
        </section>

        <!-- 블로그 페이지 -->
        <section id="blog-page" class="page-section">
            <div class="container mx-auto max-w-4xl py-12 px-4">
                <h1 class="text-4xl font-bold text-center mb-2" data-lang-key="blog_title">블로그 & 분석</h1>
                <p class="text-center text-gray-400 mb-12" data-lang-key="blog_subtitle">최신 시장 동향과 심층 분석 정보를 확인하세요.</p>
                
                <div class="space-y-12">
                    <!-- 샘플 게시글 1 -->
                    <article class="prose lg:prose-xl max-w-none">
                        <h2 data-lang-key="blog1_title">초보자를 위한 이동평균선(MA) 완벽 가이드</h2>
                        <p class="text-gray-400" data-lang-key="blog1_meta">2025년 9월 14일 · By Oracoin 분석팀</p>
                        <p data-lang-key="blog1_p1">이동평균선(Moving Average)은 기술적 분석에서 가장 기본적이면서도 강력한 도구 중 하나입니다. 일정 기간 동안의 평균 가격을 선으로 나타내어 시장의 전반적인 추세를 파악하는 데 도움을 줍니다. Oracoin에서 '상승/하락 추세'를 판단하는 데 사용하는 20일 이동평균선이 바로 이것입니다.</p>
                        <blockquote data-lang-key="blog1_quote">현재 가격이 이동평균선 위에 있다면 시장은 상승 추세에, 아래에 있다면 하락 추세에 있다고 해석할 수 있습니다.</blockquote>
                        <p data-lang-key="blog1_p2">이 글에서는 단순이동평균(SMA)과 지수이동평균(EMA)의 차이점, 그리고 골든 크로스와 데드 크로스 등 이동평균선을 활용한 구체적인 매매 전략에 대해 심도 있게 다룹니다. (애드센스 승인을 위해 최소 1000자 이상의 고유한 콘텐츠를 작성해야 합니다.)</p>
                    </article>
                     <!-- 샘플 게시글 2 -->
                    <article class="prose lg:prose-xl max-w-none">
                        <h2 data-lang-key="blog2_title">RSI 지표 120% 활용법: 과매수와 과매도 신호 읽기</h2>
                         <p class="text-gray-400" data-lang-key="blog2_meta">2025년 9월 12일 · By Oracoin 분석팀</p>
                        <p data-lang-key="blog2_p1">RSI(상대강도지수)는 현재 시장의 매수세와 매도세 중 어느 쪽이 더 강한지를 백분율로 나타내는 지표입니다. Oracoin에서는 이 지수를 통해 '과매수', '과매도' 상태를 알려드립니다. 일반적으로 RSI가 70을 넘으면 과매수 상태로, 가격이 하락할 가능성이 있다고 봅니다. 반대로 30 미만이면 과매도 상태로, 가격이 반등할 가능성이 있다고 해석합니다.</p>
                        <p data-lang-key="blog2_p2">하지만 RSI는 단순히 70과 30을 기준으로만 보아서는 안 됩니다. RSI 다이버전스(Divergence)와 같은 심화 개념을 이해하면, 시장의 변곡점을 훨씬 더 정확하게 예측할 수 있습니다. 이 글에서는 RSI의 기본 원리부터 실전 투자에서 활용할 수 있는 고급 전략까지 자세히 설명합니다.</p>
                    </article>
                    <!-- 샘플 게시글 3 -->
                    <article class="prose lg:prose-xl max-w-none">
                        <h2 data-lang-key="blog3_title">뉴스 심리 분석: 시장의 감정을 읽는 법</h2>
                         <p class="text-gray-400" data-lang-key="blog3_meta">2025년 9월 10일 · By Oracoin 분석팀</p>
                        <p data-lang-key="blog3_p1">"소문에 사서 뉴스에 팔아라"라는 투자 격언이 있습니다. 그만큼 뉴스는 시장 참여자들의 심리에 큰 영향을 미칩니다. Oracoin의 뉴스 심리 분석은 AI를 통해 최신 뉴스의 뉘앙스를 분석하여 시장의 전반적인 감정이 긍정적인지, 부정적인지를 알려주는 기능입니다.</p>
                        <p data-lang-key="blog3_p2">긍정적인 뉴스가 많아지면 투자자들의 심리가 개선되어 매수세가 강해질 수 있고, 부정적인 뉴스는 그 반대의 효과를 가져올 수 있습니다. 이 글에서는 뉴스 데이터와 기술적 지표를 함께 활용하여 어떻게 더 현명한 투자 결정을 내릴 수 있는지 구체적인 사례를 통해 알아봅니다.</p>
                    </article>
                </div>
            </div>
        </section>

        <!-- 소개 페이지 -->
        <section id="about-page" class="page-section">
            <div class="container mx-auto max-w-4xl py-12 px-4">
                <div class="prose lg:prose-xl max-w-none">
                    <h1 data-lang-key="about_title">About Oracoin</h1>
                    <p data-lang-key="about_p1">Oracoin은 복잡하고 변동성 높은 암호화폐 시장에서 투자자들이 더 나은 결정을 내릴 수 있도록 돕기 위해 탄생했습니다. 저희는 객관적인 데이터와 정교한 기술적 분석, 그리고 AI 뉴스 분석을 결합하여 시장의 추세를 예측하고, 각 코인의 현재 상태를 직관적으로 평가해주는 올인원 분석 도구입니다.</p>
                    <h2 data-lang-key="about_h2">우리의 미션</h2>
                    <p data-lang-key="about_p2">정보의 비대칭성을 해소하고, 누구나 쉽게 데이터에 기반한 현명한 투자를 할 수 있는 환경을 만드는 것입니다. 초보 투자자부터 숙련된 트레이더까지, Oracoin은 여러분의 곁에서 가장 신뢰할 수 있는 나침반이 되어드리겠습니다.</p>
                </div>
            </div>
        </section>

        <!-- 문의 페이지 -->
        <section id="contact-page" class="page-section">
            <div class="container mx-auto max-w-4xl py-12 px-4">
                 <div class="prose lg:prose-xl max-w-none">
                    <h1 data-lang-key="contact_title">Contact Us</h1>
                    <p data-lang-key="contact_p1">Oracoin에 대한 질문, 제휴 제안, 또는 피드백이 있으신가요? 언제든지 아래 이메일로 연락 주시면 최대한 빠르게 답변해 드리겠습니다.</p>
                    <p><strong>Email:</strong> <a href="mailto:contact@oracoin.dev">contact@oracoin.dev</a></p>
                </div>
            </div>
        </section>

        <!-- 개인정보처리방침 페이지 -->
        <section id="privacy-page" class="page-section">
             <div class="container mx-auto max-w-4xl py-12 px-4">
                 <div class="prose lg:prose-xl max-w-none">
                    <h1 data-lang-key="privacy_title">Privacy Policy</h1>
                    <p data-lang-key="privacy_p1">Oracoin은 사용자의 개인정보를 소중하게 생각하며, 정보통신망 이용촉진 및 정보보호 등에 관한 법률을 준수하고 있습니다. 본 개인정보처리방침은 Oracoin이 어떤 정보를 수집하고, 어떻게 사용하며, 누구와 공유하는지 등을 담고 있습니다.</p>
                    <h2 data-lang-key="privacy_h2_1">1. 수집하는 개인정보 항목</h2>
                    <p data-lang-key="privacy_p2">Oracoin은 별도의 회원가입 절차가 없으므로, 개인을 식별할 수 있는 어떠한 정보(이름, 이메일 등)도 수집하지 않습니다. 다만, 서비스 이용 과정에서 IP 주소, 쿠키, 방문 일시 등의 서비스 이용 기록이 자동으로 생성되어 수집될 수 있습니다.</p>
                    <h2 data-lang-key="privacy_h2_2">2. 개인정보의 수집 및 이용목적</h2>
                    <p data-lang-key="privacy_p3">수집된 서비스 이용 기록은 서비스 개선, 통계 분석, 접속 빈도 파악 및 사용자의 관심 분야에 따른 맞춤형 광고 제공(구글 애드센스)을 위해 사용됩니다.</p>
                 </div>
            </div>
        </section>
    </div>

    <!-- 푸터 -->
    <footer class="bg-gray-900 border-t border-gray-700">
        <div class="container mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-gray-400">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#" class="nav-link text-sm hover:text-white" data-page="about">소개</a>
                <a href="#" class="nav-link text-sm hover:text-white" data-page="contact">문의하기</a>
                <a href="#" class="nav-link text-sm hover:text-white" data-page="privacy">개인정보처리방침</a>
            </div>
            <p class="text-sm" data-lang-key="data_provider">데이터 제공: <a href="https://www.coingecko.com/" target="_blank" class="underline hover:text-blue-400">CoinGecko</a></p>
            <p class="text-xs mt-2">&copy; 2025 Oracoin. All Rights Reserved.</p>
        </div>
    </footer>
    
    <!-- 모달 -->
    <div id="modal-overlay" class="fixed inset-0 items-center justify-center hidden z-50 p-4"><div id="modal-content" class="bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-2xl mx-auto relative transform transition-all duration-300 scale-95 opacity-0"><button id="modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-white">&times;</button></div></div>
    
    <script>
        // --- 페이지 네비게이션 로직 ---
        const pageContainer = document.getElementById('page-container');
        const pageSections = document.querySelectorAll('.page-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        function showPage(pageId) {
            pageSections.forEach(section => {
                section.classList.remove('active');
            });
            const targetPage = document.getElementById(pageId + '-page');
            if(targetPage) {
                targetPage.classList.add('active');
            }
            
            navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.page === pageId);
            });
            
            window.scrollTo(0, 0); 
            mobileMenu.classList.add('hidden'); 
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = e.target.dataset.page;
                showPage(pageId);
            });
        });
        
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // --- [관리자 전용] AI 분석글 생성 도구 ---
        async function generateAiAnalysis() {
            // ... (기존 관리자 기능 코드 유지)
        }

        // --- Oracoin 분석 도구 로직 ---
        const elements = {
            sidebar: document.getElementById('sidebar'),
            sidebarToggle: document.getElementById('sidebar-toggle'),
            sidebarOverlay: document.getElementById('sidebar-overlay'),
            cryptoContainer: document.getElementById('crypto-container'),
            loadingIndicator: document.getElementById('loading-indicator'),
            searchInput: document.getElementById('search-input'),
            sortButtons: document.querySelectorAll('.sort-btn'),
            watchlistToggle: document.getElementById('watchlist-toggle'),
            noResults: document.getElementById('no-results'),
            modalOverlay: document.getElementById('modal-overlay'),
            modalContent: document.getElementById('modal-content'),
            modalClose: document.getElementById('modal-close'),
            coinListSidebar: document.getElementById('coin-list-sidebar'),
            limitMessage: document.getElementById('limit-message'),
            langButtons: document.querySelectorAll('.lang-btn'),
        };

        const apiKey = 'CG-xmGqWe2JgRKTWjf1WSPT9saQ';
        let chartInstance = null;

        const state = {
            language: 'ko',
            currency: 'krw',
            allCoins: [],
            displayedCoins: [],
            selectedCoinIds: ['bitcoin', 'ethereum', 'ripple', 'dogecoin', 'solana', 'cardano'],
            favorites: [],
            searchTerm: '',
            sortBy: 'name',
            watchlistOnly: false,
        };

        const translations = {
            ko: {
                sidebar_title: "코인 목록 (상위 100)",
                limit_message: "최대 6개까지 추가 가능합니다.",
                search_placeholder: "추가된 코인 검색...",
                sort_name: "이름순",
                sort_price: "가격순",
                sort_change: "변동률순",
                watchlist: "⭐ 관심 목록",
                no_results_text: "결과가 없습니다. 사이드바에서 코인을 추가하거나 검색어를 변경해보세요.",
                add_coin_prompt: "사이드바에서 코인을 추가하여 분석을 시작하세요.",
                eval_buy: "매수 고려",
                eval_caution: "주의 필요",
                eval_neutral: "관망",
                rsi_overbought: "과매수",
                rsi_oversold: "과매도",
                rsi_neutral: "중립",
                ma_uptrend: "상승 추세",
                ma_downtrend: "하락 추세",
                evaluation: "종합 평가",
                price: "현재가",
                change_24h: "24시간 변동",
                market_cap: "시가총액",
                high_24h: "24시간 최고가",
                low_24h: "24시간 최저가",
                total_volume: "총 거래량",
                tech_analysis: "기술적 분석",
                description: "설명",
                homepage: "공식 홈페이지",
                chart_title: "7일 가격 변동",
                // ... other keys
            },
            en: {
                sidebar_title: "Coin List (Top 100)",
                limit_message: "You can add up to 6 coins.",
                search_placeholder: "Search added coins...",
                sort_name: "By Name",
                sort_price: "By Price",
                sort_change: "By Change",
                watchlist: "⭐ Watchlist",
                no_results_text: "No results found. Add coins from the sidebar or change your search term.",
                add_coin_prompt: "Add coins from the sidebar to start analysis.",
                eval_buy: "Consider Buying",
                eval_caution: "Caution Advised",
                eval_neutral: "Neutral / Watch",
                rsi_overbought: "Overbought",
                rsi_oversold: "Oversold",
                rsi_neutral: "Neutral",
                ma_uptrend: "Uptrend",
                ma_downtrend: "Downtrend",
                evaluation: "Overall Evaluation",
                price: "Current Price",
                change_24h: "24h Change",
                market_cap: "Market Cap",
                high_24h: "24h High",
                low_24h: "24h Low",
                total_volume: "Total Volume",
                tech_analysis: "Technical Analysis",
                description: "Description",
                homepage: "Official Homepage",
                chart_title: "7-Day Price Change",
                // ... other keys
            }
        };

        function t(key) {
            return translations[state.language][key] || key;
        }

        async function setLanguage(lang) {
            if (['ko', 'en'].includes(lang)) {
                state.language = lang;
                state.currency = lang === 'ko' ? 'krw' : 'usd';
                localStorage.setItem('cryptoLang', lang);
                document.documentElement.lang = lang;
                
                elements.langButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.id === `lang-${lang}`);
                });

                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.dataset.langKey;
                    if(el.placeholder) {
                        el.placeholder = t(key);
                    } else {
                        el.textContent = t(key);
                    }
                });
                
                await fetchSidebarCoins();
                await loadData();
            }
        }

        function renderLoadingSkeletons() {
            elements.loadingIndicator.innerHTML = '';
            for (let i = 0; i < state.selectedCoinIds.length; i++) {
                const skeletonCard = `
                    <div class="skeleton-card animate-pulse">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full skeleton"></div>
                                <div class="ml-3">
                                    <div class="w-24 h-5 mb-1 skeleton"></div>
                                    <div class="w-16 h-4 skeleton"></div>
                                </div>
                            </div>
                            <div class="w-6 h-6 rounded-full skeleton"></div>
                        </div>
                        <div class="mt-4">
                            <div class="w-40 h-8 mb-2 skeleton"></div>
                            <div class="w-24 h-5 skeleton"></div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                             <div class="w-32 h-5 mb-2 skeleton"></div>
                             <div class="flex justify-between">
                                <div class="w-20 h-4 skeleton"></div>
                                <div class="w-20 h-4 skeleton"></div>
                             </div>
                        </div>
                    </div>`;
                elements.loadingIndicator.innerHTML += skeletonCard;
            }
        }
        
        function render() {
            let coinsToRender = [...state.displayedCoins];
            if (state.watchlistOnly) {
                coinsToRender = coinsToRender.filter(c => state.favorites.includes(c.id));
            }
            if (state.searchTerm) {
                coinsToRender = coinsToRender.filter(c =>
                    c.name.toLowerCase().includes(state.searchTerm.toLowerCase()) ||
                    c.symbol.toLowerCase().includes(state.searchTerm.toLowerCase())
                );
            }

            coinsToRender.sort((a, b) => {
                if (state.sortBy === 'name') return a.name.localeCompare(b.name);
                if (state.sortBy === 'price') return b.current_price - a.current_price;
                if (state.sortBy === 'change') return b.price_change_percentage_24h - a.price_change_percentage_24h;
                return 0;
            });
            
            elements.cryptoContainer.innerHTML = '';

            if (state.selectedCoinIds.length === 0) {
                 elements.noResults.innerHTML = `<p>${t('add_coin_prompt')}</p>`;
                 elements.noResults.classList.remove('hidden');
                 return;
            }
            
            if (coinsToRender.length === 0) {
                 elements.noResults.innerHTML = `<p>${t('no_results_text')}</p>`;
                 elements.noResults.classList.remove('hidden');
            } else {
                 elements.noResults.classList.add('hidden');
            }

            coinsToRender.forEach(coin => {
                const isFavorite = state.favorites.includes(coin.id);
                const priceChange = coin.price_change_percentage_24h || 0;
                const changeColor = priceChange >= 0 ? 'text-green-400' : 'text-red-400';
                const formattedPrice = new Intl.NumberFormat(state.language, {
                    style: 'currency',
                    currency: state.currency,
                    minimumFractionDigits: 2,
                    maximumFractionDigits: priceChange > 100 ? 0 : 2
                }).format(coin.current_price);
                
                const { evalClass, evalText } = getEvaluation(coin.rsi, coin.ma_20_day_comparison);
                const { rsiStatus, rsiText } = getRsiStatus(coin.rsi);
                const { maStatus, maText } = getMaStatus(coin.ma_20_day_comparison);

                const card = `
                    <div class="bg-gray-800 rounded-xl p-5 shadow-lg border border-gray-700 hover:border-blue-500 transition-all duration-300 transform hover:-translate-y-1 cursor-pointer" data-coin-id="${coin.id}">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center">
                                <img src="${coin.image}" alt="${coin.name}" class="w-10 h-10 rounded-full">
                                <div class="ml-3">
                                    <h3 class="font-bold text-lg">${coin.name}</h3>
                                    <p class="text-sm text-gray-400 uppercase">${coin.symbol}</p>
                                </div>
                            </div>
                             <div class="flex items-center">
                                <span class="star-icon text-2xl ${isFavorite ? 'favorited' : 'text-gray-600'}" data-id="${coin.id}">★</span>
                                <button class="remove-coin-btn ml-2 text-gray-500 hover:text-red-500" data-id="${coin.id}">&times;</button>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-3xl font-bold">${formattedPrice}</p>
                            <p class="text-md ${changeColor}">${priceChange.toFixed(2)}%</p>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-700">
                             <p class="text-xs text-gray-400 font-bold mb-2 uppercase">${t('evaluation')}</p>
                             <div class="flex justify-between items-center mb-2">
                                <p class="font-bold text-lg ${evalClass}">${evalText}</p>
                            </div>
                             <div class="text-xs space-y-1">
                                <div class="flex justify-between"><span class="text-gray-400">RSI:</span> <span class="${rsiStatus}">${rsiText} (${coin.rsi.toFixed(1)})</span></div>
                                <div class="flex justify-between"><span class="text-gray-400">MA(20):</span> <span class="${maStatus}">${maText}</span></div>
                             </div>
                        </div>
                    </div>
                `;
                elements.cryptoContainer.innerHTML += card;
            });
        }
        
        function renderSidebar() {
            elements.coinListSidebar.innerHTML = '';
            state.allCoins.forEach(coin => {
                const isSelected = state.selectedCoinIds.includes(coin.id);
                const item = `
                    <div class="flex items-center justify-between p-2 rounded-md hover:bg-gray-700">
                        <div class="flex items-center overflow-hidden">
                             <img src="${coin.image}" class="w-6 h-6 rounded-full mr-2">
                             <span class="font-medium text-sm truncate">${coin.name}</span>
                        </div>
                        <button class="add-coin-btn text-2xl ${isSelected ? 'text-gray-500 cursor-not-allowed' : 'text-green-400 hover:text-green-300'}" data-id="${coin.id}" ${isSelected ? 'disabled' : ''}>+</button>
                    </div>
                `;
                elements.coinListSidebar.innerHTML += item;
            });
        }
        
        async function fetchSidebarCoins() {
            const cacheKey = `sidebarCoins_${state.currency}`;
            const cached = localStorage.getItem(cacheKey);
            if (cached) {
                const { timestamp, data } = JSON.parse(cached);
                if (Date.now() - timestamp < 24 * 60 * 60 * 1000) { // 24 hours cache
                    state.allCoins = data;
                    renderSidebar();
                    return;
                }
            }
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=${state.currency}&order=market_cap_desc&per_page=100&page=1&sparkline=false&x_cg_demo_api_key=${apiKey}`);
                if (!response.ok) throw new Error('Failed to fetch sidebar coins');
                const data = await response.json();
                state.allCoins = data;
                localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data }));
                renderSidebar();
            } catch (error) {
                console.error("사이드바 코인 목록 로딩 실패:", error);
            }
        }
        
        async function loadData() {
            if (state.selectedCoinIds.length === 0) {
                render();
                return;
            }
            elements.cryptoContainer.innerHTML = '';
            renderLoadingSkeletons();

            try {
                const ids = state.selectedCoinIds.join(',');
                const marketResponse = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=${state.currency}&ids=${ids}&order=market_cap_desc&price_change_percentage=24h&x_cg_demo_api_key=${apiKey}`);
                if (!marketResponse.ok) throw new Error('Failed to fetch market data');
                const marketData = await marketResponse.json();

                const coinDataPromises = marketData.map(async (coin) => {
                    await new Promise(resolve => setTimeout(resolve, 300)); // Rate limiting
                    const chartResponse = await fetch(`https://api.coingecko.com/api/v3/coins/${coin.id}/market_chart?vs_currency=${state.currency}&days=30&x_cg_demo_api_key=${apiKey}`);
                    if (!chartResponse.ok) {
                        console.error(`${coin.name}의 차트 데이터를 가져오는 데 실패했습니다.`);
                        return { ...coin, rsi: 50, ma_20_day_comparison: 'neutral' }; 
                    }
                    const chartData = await chartResponse.json();
                    
                    const prices = chartData.prices.map(p => p[1]).slice(-21);
                    const rsi = calculateRSI(prices.slice(-15));
                    const ma_20 = prices.reduce((a, b) => a + b, 0) / prices.length;
                    const ma_20_day_comparison = coin.current_price > ma_20 ? 'above' : 'below';

                    return { ...coin, rsi, ma_20_day_comparison };
                });

                state.displayedCoins = await Promise.all(coinDataPromises);

            } catch (error) {
                console.error("데이터 로딩 실패:", error);
                elements.cryptoContainer.innerHTML = `<p class="col-span-full text-center text-red-400">데이터를 불러오는 데 실패했습니다. 잠시 후 다시 시도해주세요.</p>`;
            } finally {
                elements.loadingIndicator.innerHTML = '';
                render();
            }
        }

        function calculateRSI(prices) {
            if (prices.length < 15) return 50;
            let gains = 0;
            let losses = 0;
            for (let i = 1; i < prices.length; i++) {
                const diff = prices[i] - prices[i - 1];
                if (diff > 0) {
                    gains += diff;
                } else {
                    losses -= diff;
                }
            }
            const avgGain = gains / 14;
            const avgLoss = losses / 14;
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        function getRsiStatus(rsi) {
            if (rsi > 70) return { rsiStatus: 'eval-caution', rsiText: t('rsi_overbought') };
            if (rsi < 30) return { rsiStatus: 'eval-buy', rsiText: t('rsi_oversold') };
            return { rsiStatus: 'eval-neutral', rsiText: t('rsi_neutral') };
        }

        function getMaStatus(ma_comparison) {
            if (ma_comparison === 'above') return { maStatus: 'eval-buy', maText: t('ma_uptrend') };
            if (ma_comparison === 'below') return { maStatus: 'eval-caution', maText: t('ma_downtrend') };
            return { maStatus: 'eval-neutral', maText: t('ma_neutral') };
        }

        function getEvaluation(rsi, ma_comparison) {
            let score = 0;
            if (rsi < 30) score++;
            if (rsi > 70) score--;
            if (ma_comparison === 'above') score++;
            if (ma_comparison === 'below') score--;

            if (score > 0) return { evalClass: 'eval-buy', evalText: t('eval_buy') };
            if (score < 0) return { evalClass: 'eval-caution', evalText: t('eval_caution') };
            return { evalClass: 'eval-neutral', evalText: t('eval_neutral') };
        }
        
        function handleFavorite(id) {
            const index = state.favorites.indexOf(id);
            if (index > -1) {
                state.favorites.splice(index, 1);
            } else {
                state.favorites.push(id);
            }
            localStorage.setItem('cryptoFavorites', JSON.stringify(state.favorites));
            render();
        }

        function handleAddCoin(id) {
            if (state.selectedCoinIds.length >= 6) {
                elements.limitMessage.classList.remove('opacity-0');
                setTimeout(() => elements.limitMessage.classList.add('opacity-0'), 2000);
                return;
            }
            if (!state.selectedCoinIds.includes(id)) {
                state.selectedCoinIds.push(id);
                localStorage.setItem('selectedCoinIds', JSON.stringify(state.selectedCoinIds));
                loadData();
                renderSidebar();
            }
        }

        function handleRemoveCoin(id) {
            state.selectedCoinIds = state.selectedCoinIds.filter(coinId => coinId !== id);
            state.displayedCoins = state.displayedCoins.filter(coin => coin.id !== id);
            localStorage.setItem('selectedCoinIds', JSON.stringify(state.selectedCoinIds));
            render();
            renderSidebar();
        }

        async function showModal(coinId) {
            elements.modalOverlay.classList.remove('hidden');
            elements.modalOverlay.classList.add('flex');
            
            const coin = state.displayedCoins.find(c => c.id === coinId);
            if (!coin) return;

            const modalHtml = `
                <div class="flex items-center mb-4">
                    <img src="${coin.image}" class="w-12 h-12 mr-4">
                    <div>
                        <h2 class="text-3xl font-bold">${coin.name}</h2>
                        <p class="text-gray-400 uppercase">${coin.symbol}</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm mb-6">
                    <div><p class="text-gray-400">${t('price')}</p><p class="font-bold text-lg">${new Intl.NumberFormat(state.language, { style: 'currency', currency: state.currency }).format(coin.current_price)}</p></div>
                    <div><p class="text-gray-400">${t('change_24h')}</p><p class="font-bold text-lg ${coin.price_change_percentage_24h >= 0 ? 'text-green-400' : 'text-red-400'}">${coin.price_change_percentage_24h.toFixed(2)}%</p></div>
                    <div><p class="text-gray-400">${t('market_cap')}</p><p class="font-bold text-lg">${new Intl.NumberFormat(state.language, { style: 'currency', currency: state.currency, notation: 'compact' }).format(coin.market_cap)}</p></div>
                    <div><p class="text-gray-400">${t('high_24h')}</p><p class="font-bold text-lg">${new Intl.NumberFormat(state.language, { style: 'currency', currency: state.currency }).format(coin.high_24h)}</p></div>
                    <div><p class="text-gray-400">${t('low_24h')}</p><p class="font-bold text-lg">${new Intl.NumberFormat(state.language, { style: 'currency', currency: state.currency }).format(coin.low_24h)}</p></div>
                    <div><p class="text-gray-400">${t('total_volume')}</p><p class="font-bold text-lg">${new Intl.NumberFormat(state.language, { style: 'currency', currency: state.currency, notation: 'compact' }).format(coin.total_volume)}</p></div>
                </div>
                <div class="mb-6"><canvas id="priceChart"></canvas></div>
                <div class="prose max-w-none">
                    <h3 class="font-bold" data-lang-key="description">${t('description')}</h3>
                    <p id="coin-description" class="text-gray-300 text-sm">Loading...</p>
                    <a href="${coin.homepage ? coin.homepage[0] : '#'}" target="_blank" class="text-blue-400 hover:underline" data-lang-key="homepage">${t('homepage')} &rarr;</a>
                </div>
            `;
            elements.modalContent.innerHTML = modalHtml;
            setTimeout(() => {
                elements.modalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);

            try {
                const detailsResponse = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}?localization=true&tickers=false&market_data=false&community_data=false&developer_data=false&sparkline=false&x_cg_demo_api_key=${apiKey}`);
                const details = await detailsResponse.json();
                const description = details.description?.[state.language] || details.description?.en || 'Description not available.';
                document.getElementById('coin-description').innerHTML = description.split('\n\n')[0];

                const chartResponse = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}/market_chart?vs_currency=${state.currency}&days=7&interval=daily&x_cg_demo_api_key=${apiKey}`);
                const chartData = await chartResponse.json();
                renderChart(chartData.prices);
            } catch (error) {
                console.error("Modal data loading failed:", error);
                document.getElementById('coin-description').textContent = 'Failed to load details.';
            }
        }
        
        function renderChart(prices) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            if (chartInstance) {
                chartInstance.destroy();
            }
            const labels = prices.map(p => new Date(p[0]).toLocaleDateString(state.language));
            const data = prices.map(p => p[1]);

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: t('chart_title'),
                        data: data,
                        borderColor: 'rgba(59, 130, 246, 0.8)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { ticks: { color: '#9ca3af' }, grid: { color: '#374151' } },
                        x: { ticks: { color: '#9ca3af' }, grid: { color: 'transparent' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function closeModal() {
            elements.modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                elements.modalOverlay.classList.add('hidden');
                elements.modalOverlay.classList.remove('flex');
            }, 300);
        }

        function setupEventListeners() {
            elements.sidebarToggle.addEventListener('click', () => {
                elements.sidebar.classList.toggle('-translate-x-full');
                elements.sidebarOverlay.classList.toggle('hidden');
            });
            elements.sidebarOverlay.addEventListener('click', () => {
                elements.sidebar.classList.add('-translate-x-full');
                elements.sidebarOverlay.classList.add('hidden');
            });
            
            elements.searchInput.addEventListener('input', (e) => {
                state.searchTerm = e.target.value;
                render();
            });

            elements.sortButtons.forEach(button => {
                button.addEventListener('click', () => {
                    state.sortBy = button.id.split('-')[1];
                    elements.sortButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    render();
                });
            });

            elements.watchlistToggle.addEventListener('change', (e) => {
                state.watchlistOnly = e.target.checked;
                render();
            });

            elements.cryptoContainer.addEventListener('click', (e) => {
                const card = e.target.closest('[data-coin-id]');
                const star = e.target.closest('.star-icon');
                const removeBtn = e.target.closest('.remove-coin-btn');
                
                if(removeBtn) {
                    e.stopPropagation();
                    handleRemoveCoin(removeBtn.dataset.id);
                    return;
                }
                if (star) {
                    e.stopPropagation();
                    handleFavorite(star.dataset.id);
                    return;
                }
                if (card) {
                    showModal(card.dataset.coin-id);
                }
            });
            
            elements.coinListSidebar.addEventListener('click', e => {
                const addBtn = e.target.closest('.add-coin-btn');
                if(addBtn && !addBtn.disabled) {
                    handleAddCoin(addBtn.dataset.id);
                }
            });

            elements.modalOverlay.addEventListener('click', (e) => {
                if (e.target === elements.modalOverlay) closeModal();
            });
            elements.modalClose.addEventListener('click', closeModal);
            
            elements.langButtons.forEach(button => {
                button.addEventListener('click', () => setLanguage(button.id.split('-')[1]));
            });
        }
        
        function initialize() {
            showPage('home');
            
            const savedLang = localStorage.getItem('cryptoLang') || (navigator.language.startsWith('ko') ? 'ko' : 'en');
            setLanguage(savedLang);

            const savedFavorites = localStorage.getItem('cryptoFavorites');
            if (savedFavorites) {
                state.favorites = JSON.parse(savedFavorites);
            }
            
            const savedSelectedCoins = localStorage.getItem('selectedCoinIds');
            if(savedSelectedCoins) {
                state.selectedCoinIds = JSON.parse(savedSelectedCoins);
            }
            
            setupEventListeners();
            
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js').catch(err => console.log('SW registration failed: ', err));
                });
            }
        }

        document.addEventListener('DOMContentLoaded', initialize);

    </script>
</body>
</html>

